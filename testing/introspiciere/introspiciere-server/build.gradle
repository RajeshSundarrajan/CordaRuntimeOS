plugins {
    id 'com.r3.internal.gradle.plugins.r3Publish'
}

description "Introspiciere REST server"

dependencies {
    implementation "io.javalin:javalin:$javalinVersion"
    implementation "org.slf4j:slf4j-simple:$slf4jVersion"
    implementation "org.slf4j:slf4j-api:$slf4jVersion"
    implementation "com.fasterxml.jackson.module:jackson-module-kotlin:$jacksonVersion"

    implementation project(':testing:introspiciere:introspiciere-core')
    implementation project(':testing:introspiciere:introspiciere-payloads')
    implementation project(':testing:introspiciere:introspiciere-domain')
}

jar {
    // not sure why the dependency is not building automatically
    dependsOn ':testing:introspiciere:introspiciere-core:jar'
    dependsOn ':testing:introspiciere:introspiciere-client:jar'
    dependsOn ':testing:introspiciere:introspiciere-junit:jar'
    dependsOn ':testing:introspiciere:introspiciere-cli:jar'

    duplicatesStrategy = DuplicatesStrategy.EXCLUDE

    manifest {
        attributes "Main-Class": "net.corda.introspiciere.server.MainKt"
    }

    exclude 'META-INF/*.EC'
    exclude 'META-INF/*.SF'
    exclude 'META-INF/*.DSA'
    exclude 'META-INF/*.RSA'

    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
}