plugins {
    id 'com.r3.internal.gradle.plugins.r3Publish'
}

description "Introspiciere core"

dependencies {
    implementation project(":testing:introspiciere:introspiciere-client")
    implementation project(":testing:introspiciere:introspiciere-payloads")
    implementation project(":testing:introspiciere:introspiciere-domain")

    implementation "net.corda:corda-avro-schema:$cordaApiVersion"
    implementation "net.corda:corda-topic-schema:$cordaApiVersion"

    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlinVersion"
    implementation "info.picocli:picocli:$picocliVersion"
    implementation "org.apache.avro:avro:$avroVersion"

    integrationTestImplementation project(":testing:introspiciere:introspiciere-junit")
}

jar {
    // not sure why the dependency is not building automatically
    dependsOn ':testing:introspiciere:introspiciere-client:build'

    duplicatesStrategy = DuplicatesStrategy.EXCLUDE

    manifest {
        attributes "Main-Class": "net.corda.introspiciere.cli.MainKt"
    }

    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
}